#!/usr/bin/env ruby

require 'chore'

#TODO: Do this right
server_name = 'localhost'
server_port = Chore::Constants::DEFAULT_LISTEN_PORT
server_name = ARGV[0] if ARGV[0]
server_port = ARGV[1].to_i if ARGV[1]

Chore.set_server(server_name,server_port)

Chore.monitor("good task") do
  puts "Good"
end

Chore.start(:pop_it)
Chore.finish(:pop_it)
Chore.pop(:pop_it)

Chore.monitor(:auto_pop, :pop => true) {} # should not show up

Chore.monitor(:no_pop) {} # should show up

Chore.start(:expire_now, :expire_in => 0) {}
Chore.start(:expire_in_one_minute, :expire_in => 60) {}
Chore.start(:expire_in_a_while, :expire_in => 1000000000) {}

begin
  Chore.monitor("bad task") do
    raise "AAAAAAAAAAAAAAAAAAAAA"
  end
rescue Exception => ex
  # don't spit out error
end
