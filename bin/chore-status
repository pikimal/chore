#!/usr/bin/env ruby

require 'socket'
require 'chore/constants'
require 'trollop'

opts = Trollop::options do
  banner "chore-status"

  opt :host, "host name of chore-server", :default => 'localhost'
  opt :port, "port of chore-server", :default => Chore::Constants::DEFAULT_CLI_PORT
end

server = opts[:host]
port = opts[:port]

begin
  sock = TCPSocket.open(server,port)
  sock.puts ".\r\n"

  while next_line = sock.gets
    puts next_line
  end

  sock.close
rescue Errno::ECONNREFUSED, Errno::ETIMEDOUT => ex
  puts "Couldn't connect to chore-server at #{server}:#{port}"
end
